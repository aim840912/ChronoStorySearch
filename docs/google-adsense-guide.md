# Google AdSense 廣告配置指南

> 本文件說明 ChronoStory 專案的 Google AdSense 廣告系統架構、現有配置、以及建議的優化方向。

---

## 目錄

1. [現有廣告系統架構](#現有廣告系統架構)
2. [廣告組件說明](#廣告組件說明)
3. [版面視圖分析](#版面視圖分析)
4. [AdSense 廣告類型適用建議](#adsense-廣告類型適用建議)
5. [建議新增的廣告位置](#建議新增的廣告位置)
6. [環境變數配置](#環境變數配置)
7. [最佳實踐](#最佳實踐)

---

## 現有廣告系統架構

### 組件層級結構

```
AdSenseScript (Root Layout - 全域廣告腳本)
├── AdSense JS 加載腳本
├── Funding Choices 腳本 (廣告封鎖復原)
└── Funding Choices Signal (偵測廣告封鎖器)

廣告組件
├── AdSenseCard      → 信息流廣告（插在卡片列表間）
├── AdSenseDisplay   → 展示廣告（Modal 側邊）
└── AdSenseAnchor    → 錨定廣告（Modal 頂部）
```

### 檔案位置

| 組件 | 路徑 |
|------|------|
| AdSenseScript | `/src/components/adsense/AdSenseScript.tsx` |
| AdSenseCard | `/src/components/adsense/AdSenseCard.tsx` |
| AdSenseDisplay | `/src/components/adsense/AdSenseDisplay.tsx` |
| AdSenseAnchor | `/src/components/adsense/AdSenseAnchor.tsx` |
| 匯出入口 | `/src/components/adsense/index.ts` |

### 現有廣告配置

| 廣告類型 | 組件 | 目前位置 | 尺寸 | 裝置 |
|---------|------|---------|------|------|
| 信息流廣告 | `AdSenseCard` | 卡片列表間 | Fluid | 全裝置 |
| 展示廣告 | `AdSenseDisplay` | Modal 左右兩側 | 160×600 | Desktop (1120px+) |
| 錨定廣告 | `AdSenseAnchor` | Modal 頂部 | 320×50 | Mobile/Tablet |

---

## 廣告組件說明

### 1. AdSenseCard（信息流廣告）

用於卡片列表間的原生廣告，與內容自然融合。

```tsx
// 使用方式
import { AdSenseCard } from '@/components/adsense'

// 在列表中插入
{items.map((item, index) => (
  <>
    <ItemCard key={item.id} {...item} />
    {(index + 1) % 6 === 0 && <AdSenseCard key={`ad-${index}`} />}
  </>
))}
```

**特點**：
- Fluid 格式，自動適應容器寬度
- 開發環境顯示佔位預覽
- 生產環境無配置時返回 null

### 2. AdSenseDisplay（展示廣告）

用於 Modal 側邊的垂直廣告。

```tsx
// 使用方式
<AdSenseDisplay position="left" />
<AdSenseDisplay position="right" />
```

**特點**：
- 固定尺寸 160×600 (Skyscraper)
- 僅在 Desktop (1120px+) 顯示
- 使用 sticky 定位跟隨滾動

### 3. AdSenseAnchor（錨定廣告）

用於 Modal 頂部的橫幅廣告。

```tsx
// 使用方式
<AdSenseAnchor />
```

**特點**：
- 固定尺寸 320×50
- 僅在 Mobile/Tablet 顯示
- 固定在 Modal 頂部

---

## 版面視圖分析

### 首頁版面（非 Modal 狀態）

```
┌─────────────────────────────────────────────────────────────┐
│  Header (Sticky)                                            │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  Logo  搜尋框  主題/語言切換                           │  │
│  │  FilterTabs  ActionButtons  篩選選項                   │  │
│  └───────────────────────────────────────────────────────┘  │
│  ❌ 不適合放廣告（會干擾導航和搜尋）                         │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  💡 【建議位置 A】橫幅廣告 728×90                            │
│  位置：篩選條件下方、搜尋結果上方                            │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ 卡片 1  │ │ 卡片 2  │ │ 卡片 3  │ │ 卡片 4  │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ 卡片 5  │ │ 卡片 6  │ │ 卡片 7  │ │ 卡片 8  │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
│                                                             │
│  ┌───────────────────────────────────────────────────────┐  │
│  │  ✅ AdSenseCard（信息流廣告）- 已實作                   │  │
│  │  每 N 張卡片後插入一個廣告                              │  │
│  └───────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐           │
│  │ 卡片 9  │ │ 卡片 10 │ │ 卡片 11 │ │ 卡片 12 │           │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘           │
│                                                             │
│  ... 無限滾動載入更多 ...                                   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  💡 【建議位置 B】Multiplex 多重廣告                         │
│  位置：列表結束後、Footer 上方                              │
│  格式：300×250 × 4 網格                                     │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  Footer（版權資訊）                                         │
│  ❌ 不適合放廣告                                            │
└─────────────────────────────────────────────────────────────┘

💡 【建議位置 C】頁面底部固定錨定廣告（Mobile）
位置：螢幕底部固定
格式：320×50 橫幅
```

### Modal 版面（怪物/物品詳情）

```
Desktop (1120px+)
┌──────────────┐ ┌────────────────────────────────┐ ┌──────────────┐
│              │ │                                │ │              │
│  ✅          │ │  Modal Header                  │ │  ✅          │
│  AdSense     │ │  ┌────────────────────────┐    │ │  AdSense     │
│  Display     │ │  │  怪物/物品圖片          │    │ │  Display     │
│              │ │  │  基本資訊               │    │ │              │
│  160×600     │ │  │  屬性卡片               │    │ │  160×600     │
│  Skyscraper  │ │  └────────────────────────┘    │ │  Skyscraper  │
│              │ │                                │ │              │
│  左側        │ │  掉落物品/怪物列表              │ │  右側        │
│              │ │  ┌────────────────────────┐    │ │              │
│              │ │  │ 物品1 │ 物品2 │ 物品3  │    │ │              │
│              │ │  ├────────────────────────┤    │ │              │
│              │ │  │ ✅ AdSenseCard         │    │ │              │
│              │ │  ├────────────────────────┤    │ │              │
│              │ │  │ 物品4 │ 物品5 │ 物品6  │    │ │              │
│              │ │  └────────────────────────┘    │ │              │
│              │ │                                │ │              │
└──────────────┘ └────────────────────────────────┘ └──────────────┘

Mobile/Tablet (<1120px)
┌────────────────────────────────────┐
│  ✅ AdSenseAnchor (320×50)         │
│  錨定在 Modal 頂部                  │
├────────────────────────────────────┤
│                                    │
│  Modal Header                      │
│  ┌────────────────────────────┐    │
│  │  怪物/物品圖片              │    │
│  │  基本資訊                   │    │
│  └────────────────────────────┘    │
│                                    │
│  掉落物品/怪物列表                  │
│  ┌────────────────────────────┐    │
│  │ 物品1 │ 物品2               │    │
│  ├────────────────────────────┤    │
│  │ ✅ AdSenseCard             │    │
│  ├────────────────────────────┤    │
│  │ 物品3 │ 物品4               │    │
│  └────────────────────────────┘    │
│                                    │
└────────────────────────────────────┘
```

### 空狀態版面（無搜尋結果）

```
┌─────────────────────────────────────────────────────────────┐
│  Header                                                     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│                                                             │
│                    ┌─────────────────┐                      │
│                    │                 │                      │
│                    │   找不到結果     │                      │
│                    │   請嘗試其他     │                      │
│                    │   搜尋條件       │                      │
│                    │                 │                      │
│                    └─────────────────┘                      │
│                                                             │
│  💡 【建議位置 D】矩形廣告 300×250                           │
│  位置：空狀態訊息下方                                        │
│  目的：填補空白區域，增加收益                                │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  Footer                                                     │
└─────────────────────────────────────────────────────────────┘
```

---

## AdSense 廣告類型適用建議

### 1. 信息流廣告 (In-feed Ads) ✅ 已實作

| 項目 | 說明 |
|------|------|
| 適用位置 | 卡片列表間、掉落物品列表間 |
| 格式 | Fluid（自動適應） |
| 優點 | 與內容自然融合，用戶接受度高 |
| 建議間隔 | 每 6-8 張卡片插入一個廣告 |

### 2. 展示廣告 (Display Ads) ✅ 已實作

| 項目 | 說明 |
|------|------|
| 適用位置 | Modal 側邊、頁面側邊欄 |
| 常用尺寸 | 160×600（Skyscraper）、300×250（矩形）、728×90（橫幅） |
| 優點 | 高可見度，適合品牌廣告 |
| 注意 | 需考慮響應式設計，小螢幕需隱藏 |

### 3. 錨定廣告 (Anchor Ads) ✅ 已實作

| 項目 | 說明 |
|------|------|
| 適用位置 | Modal 頂部（Mobile）、頁面底部固定 |
| 格式 | 320×50（Mobile）、728×90（Desktop） |
| 優點 | 持續曝光，不佔用內容空間 |
| 注意 | 避免過度干擾，需提供關閉選項 |

### 4. 多重廣告 (Multiplex Ads) ⚠️ 建議新增

| 項目 | 說明 |
|------|------|
| 適用位置 | 列表底部、Footer 上方 |
| 格式 | 2×2 或 1×4 網格 |
| 優點 | 類似「相關推薦」，點擊率較高 |
| 適用場景 | 內容結束處，作為延伸閱讀 |

### 5. 文章內廣告 (In-article Ads) ⚠️ 可考慮

| 項目 | 說明 |
|------|------|
| 適用位置 | 長文本區域（物品描述、使用說明） |
| 格式 | Fluid |
| 優點 | 適合長內容頁面 |
| 本專案適用性 | 較低（內容以列表為主） |

### 6. 自動廣告 (Auto Ads) ⚠️ 謹慎使用

| 項目 | 說明 |
|------|------|
| 優點 | Google 自動優化位置、省事 |
| 缺點 | 難以控制版面、可能影響 UX |
| 建議 | 可開啟但設定排除區域 |

---

## 建議新增的廣告位置

### 優先級排序

| 優先級 | 位置 | 廣告類型 | 尺寸 | 預估影響 | 實作難度 |
|-------|------|---------|------|---------|---------|
| 🔴 高 | 搜尋結果上方 | 橫幅 | 728×90 / 320×50 | 高曝光 | 中 |
| 🔴 高 | 頁面底部固定 | 錨定 | 320×50 | Mobile 額外收益 | 低 |
| 🟡 中 | 列表底部 | Multiplex | 300×250 ×4 | 自然結束位置 | 中 |
| 🟡 中 | 空狀態頁面 | 矩形 | 300×250 | 填補空白 | 低 |
| 🟢 低 | 轉蛋結果區 | 信息流 | Fluid | 特定功能區 | 低 |

### 位置 A：搜尋結果上方橫幅

```tsx
// 建議位置：SearchHeader 下方、卡片列表上方
// 檔案：src/components/ContentDisplay.tsx 或 src/app/page.tsx

<SearchHeader />
<AdSenseBanner /> {/* 新增 */}
<CardGrid>
  {/* 卡片列表 */}
</CardGrid>
```

### 位置 B：列表底部 Multiplex

```tsx
// 建議位置：無限滾動結束後
// 檔案：src/components/lists/AllItemsView.tsx

{hasMoreItems ? (
  <InfiniteScrollTrigger />
) : (
  <AdSenseMultiplex /> {/* 新增 */}
)}
```

### 位置 C：頁面底部固定錨定

```tsx
// 建議位置：非 Modal 狀態時的頁面底部
// 檔案：src/app/layout.tsx 或 src/components/Providers.tsx

<main>{children}</main>
<Footer />
<AdSenseBottomAnchor /> {/* 新增 - 僅 Mobile */}
```

### 位置 D：空狀態廣告

```tsx
// 建議位置：EmptyState 組件內
// 檔案：src/components/lists/EmptyState.tsx

<div className="empty-state">
  <p>找不到符合條件的結果</p>
  <AdSenseRectangle /> {/* 新增 */}
</div>
```

---

## 環境變數配置

### 必要環境變數

```env
# .env.local

# AdSense 基本配置
NEXT_PUBLIC_ADSENSE_CLIENT_ID=ca-pub-xxxxxxxxxx  # AdSense 發布商 ID

# 廣告單元 Slot ID
NEXT_PUBLIC_ADSENSE_INFEED_SLOT=1234567890       # 信息流廣告
NEXT_PUBLIC_ADSENSE_DISPLAY_SLOT=2345678901      # 展示廣告 (160×600)
NEXT_PUBLIC_ADSENSE_ANCHOR_SLOT=3456789012       # 錨定廣告 (320×50)

# 建議新增的 Slot
NEXT_PUBLIC_ADSENSE_BANNER_SLOT=4567890123       # 橫幅廣告 (728×90)
NEXT_PUBLIC_ADSENSE_MULTIPLEX_SLOT=5678901234    # 多重廣告
NEXT_PUBLIC_ADSENSE_RECTANGLE_SLOT=6789012345    # 矩形廣告 (300×250)

# 廣告開關
NEXT_PUBLIC_ADS_ENABLED=true                      # false 時禁用全部廣告
```

### 開發環境行為

- `NEXT_PUBLIC_ADS_ENABLED=false`：完全禁用廣告
- 無 Slot ID 配置：顯示佔位預覽區塊
- 生產環境無配置：組件返回 null

---

## 最佳實踐

### 廣告密度控制

| 項目 | 建議 |
|------|------|
| 內容與廣告比例 | 至少 3:1（3 份內容 : 1 份廣告） |
| 信息流廣告間隔 | 每 6-8 張卡片插入一個 |
| 同螢幕可見廣告 | 最多 2-3 個 |

### 響應式設計

| 裝置 | 寬度 | 廣告配置 |
|------|------|---------|
| Mobile | < 640px | 隱藏側邊廣告，顯示錨定廣告 |
| Tablet | 640px - 1120px | 隱藏側邊廣告，顯示頂部橫幅 |
| Desktop | > 1120px | 顯示側邊廣告，可選頂部橫幅 |

### 效能優化

```tsx
// 1. 使用 lazy loading
<ins className="adsbygoogle"
     data-ad-client="ca-pub-xxx"
     data-ad-slot="xxx"
     data-ad-format="auto"
     data-full-width-responsive="true"
     loading="lazy" />  {/* 延遲載入 */}

// 2. 避免 Layout Shift
<div style={{ minHeight: '250px' }}>  {/* 預留空間 */}
  <AdSenseCard />
</div>

// 3. 條件渲染
{isClient && <AdSenseCard />}  {/* 避免 SSR/CSR 不一致 */}
```

### 用戶體驗考量

- ❌ 不要在用戶操作區域（按鈕、輸入框）附近放置廣告
- ❌ 不要使用會遮擋內容的全螢幕廣告
- ❌ 不要在載入過程中顯示廣告（等內容載入完成）
- ✅ 提供清晰的廣告標示（Google 自動處理）
- ✅ 確保廣告可被跳過或關閉（錨定廣告）
- ✅ 保持頁面載入速度優先

### 政策合規

- 確保網站內容符合 [AdSense 計畫政策](https://support.google.com/adsense/answer/48182)
- 不要鼓勵用戶點擊廣告
- 不要在違規內容頁面顯示廣告
- 正確實作 Cookie 同意機制（GDPR/CCPA）

---

## 相關資源

- [Google AdSense 說明中心](https://support.google.com/adsense)
- [AdSense 廣告格式指南](https://support.google.com/adsense/answer/9183460)
- [Web Vitals 與廣告優化](https://web.dev/vitals/)
- [Funding Choices 設定指南](https://support.google.com/fundingchoices)

---

*最後更新：2025-12-19*
