# Discord äº¤æ˜“ç³»çµ±å¯¦ä½œé€²åº¦å ±å‘Š

> **åˆ†ææ—¥æœŸ**: 2025-10-26
> **åˆ†æç¯„åœ**: éšæ®µ 0-2ï¼ˆåŸºç¤æ¶æ§‹ + Discord OAuth + æ ¸å¿ƒåŠŸèƒ½ï¼‰
> **åƒè€ƒæ–‡ä»¶**: `/docs/architecture/äº¤æ˜“ç³»çµ±/08-å¯¦ä½œè·¯ç·šåœ–.md`

---

## ç¸½é«”é€²åº¦æ‘˜è¦

### é€²åº¦ç¸½è¦½

| éšæ®µ | æ™‚ç¨‹é è¨ˆ | å¯¦ä½œç‹€æ…‹ | å®Œæˆåº¦ | å‚™è¨» |
|------|---------|---------|--------|------|
| **éšæ®µ 0: åŸºç¤æ¶æ§‹** | Week 1-4 | âœ… å·²å®Œæˆ | **100%** | Supabase + Redis å®Œæ•´å¯¦ä½œ |
| **éšæ®µ 1: Discord OAuth** | Week 5-8 | âœ… å·²å®Œæˆ | **100%** | å®Œæ•´èªè­‰æµç¨‹å·²å¯¦ä½œ |
| **éšæ®µ 2: æ ¸å¿ƒåŠŸèƒ½** | Week 9-12 | âš ï¸ éƒ¨åˆ†å®Œæˆ | **70%** | åˆŠç™»/å¸‚å ´/æ„å‘ API å®Œæˆï¼Œéƒ¨åˆ† UI å…ƒä»¶éœ€å®Œå–„ |

**ç¸½é«”å®Œæˆåº¦**: **90%**ï¼ˆéšæ®µ 0-2ï¼‰

**é—œéµé‡Œç¨‹ç¢‘**:
- âœ… åŸºç¤æ¶æ§‹å®Œå…¨å°±ç·’ï¼ˆSupabase + Redis + ä¸­é–“ä»¶ï¼‰
- âœ… Discord OAuth 2.0 å®Œæ•´å¯¦ä½œ
- âœ… æ ¸å¿ƒ API å…¨éƒ¨å¯¦ä½œï¼ˆåˆŠç™»ã€å¸‚å ´ã€æ„å‘ï¼‰
- âš ï¸ éƒ¨åˆ†åŠŸèƒ½è¿”å› 501 Not Implementedï¼ˆtrendingã€searchã€exchange-matchesï¼‰
- âš ï¸ å‰ç«¯å…ƒä»¶åŒ…å« TODO è¨»è§£

---

## éšæ®µ 0: åŸºç¤æ¶æ§‹ï¼ˆWeek 1-4ï¼‰

### å®Œæˆåº¦: 100% âœ…

### è©³ç´°æª¢æŸ¥æ¸…å–®

#### Week 1-2: Supabase ç’°å¢ƒè¨­å®š

- [x] **å»ºç«‹ Supabase å°ˆæ¡ˆ** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/lib/supabase/server.ts`
  - å·²å¯¦ä½œ `supabaseAdmin` å’Œ `supabaseServer` å…©å€‹å®¢æˆ¶ç«¯
  - ç’°å¢ƒè®Šæ•¸æª¢æŸ¥å®Œæ•´

- [x] **å®‰è£ä¾è³´**: `@supabase/supabase-js` - å·²å®‰è£
  - ç‰ˆæœ¬: `@supabase/supabase-js@2.76.1`
  - ç‹€æ…‹: âœ… å·²å®‰è£ä¸”é…ç½®æ­£ç¢º

- [x] **å»ºç«‹è³‡æ–™åº«è¡¨** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/docs/sql/00-init-schema.sql`
  - åŒ…å«è¡¨: `users`, `sessions`, `listings`, `interests`, `discord_profiles`, `reputation_history`, `audit_logs`
  - Schema å®Œæ•´ä¸”ç¬¦åˆæ¶æ§‹æ–‡ä»¶è¦æ±‚
  - ç´¢å¼•å„ªåŒ–å·²å®Œæˆ

- [x] **è¨­å®š RLS ç­–ç•¥** - éœ€ç¢ºèª
  - âš ï¸ Schema æª”æ¡ˆå·²å»ºç«‹è¡¨çµæ§‹ï¼Œä½† RLS ç­–ç•¥éœ€åœ¨ Supabase Dashboard æ‰‹å‹•é…ç½®
  - **å»ºè­°**: åŸ·è¡Œ SQL æª”æ¡ˆå¾Œï¼Œåœ¨ Supabase æ§åˆ¶å°æª¢æŸ¥ RLS ç‹€æ…‹

#### Week 3-4: ç’°å¢ƒé…ç½®èˆ‡åŸºç¤å·¥å…·

- [x] **å®‰è£ Redis**: `@upstash/redis` - å·²å®‰è£
  - ç‰ˆæœ¬: `@upstash/redis@1.35.6`
  - ç‹€æ…‹: âœ… å·²å®‰è£ä¸”é…ç½®æ­£ç¢º

- [x] **å»ºç«‹ Supabase å®¢æˆ¶ç«¯å·¥å…·** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/lib/supabase/server.ts`
  - æä¾› `supabaseAdmin`ï¼ˆç¹é RLSï¼‰å’Œ `supabaseServer`ï¼ˆéµå®ˆ RLSï¼‰

- [x] **å»ºç«‹ Redis å®¢æˆ¶ç«¯** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/lib/redis/client.ts`
  - å¯¦ä½œ: `redis` å®¢æˆ¶ç«¯ã€`RedisKeys` å‘½åç©ºé–“ã€`RedisUtils` å·¥å…·å‡½æ•¸
  - åŠŸèƒ½: Session ç®¡ç†ã€Rate Limitingã€Bot Detectionã€OAuth State

- [x] **è¨­å®šç’°å¢ƒè®Šæ•¸** - å·²å®Œæˆ
  - æª¢æŸ¥: æ‰€æœ‰å®¢æˆ¶ç«¯æª”æ¡ˆéƒ½åŒ…å«ç’°å¢ƒè®Šæ•¸é©—è­‰
  - éœ€è¦çš„è®Šæ•¸:
    - `NEXT_PUBLIC_SUPABASE_URL`
    - `SUPABASE_SERVICE_ROLE_KEY`
    - `NEXT_PUBLIC_SUPABASE_ANON_KEY`
    - `UPSTASH_REDIS_REST_URL`
    - `UPSTASH_REDIS_REST_TOKEN`

- [x] **å»ºç«‹ API ä¸­é–“ä»¶æ¶æ§‹** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/lib/middleware/api-middleware.ts`
  - å¯¦ä½œ: `requireAuth`, `requireAdmin`, `optionalAuth`
  - å¯¦ä½œ: `withAuthAndError`, `withAdminAndError`, `withOptionalAuthAndError`
  - åŠŸèƒ½: èªè­‰é©—è­‰ã€å°ç¦æª¢æŸ¥ã€ç®¡ç†å“¡æ¬Šé™æª¢æŸ¥

- [x] **å»ºç«‹ Session é©—è­‰é‚è¼¯** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/lib/auth/session-validator.ts`
  - å¯¦ä½œ: `validateSession`, `createSession`, `refreshSession`, `revokeSession`
  - åŠŸèƒ½: JWT é©—è­‰ã€Session ç®¡ç†ã€éæœŸæª¢æŸ¥ã€è‡ªå‹•æ›´æ–° last_active_at
  - âš ï¸ åŒ…å« TODO: Token åŠ å¯†å­˜å„²ï¼ˆç›®å‰ä»¥æ˜æ–‡å­˜å„²ï¼‰

#### ç¨‹å¼ç¢¼å“è³ªè©•ä¼°

âœ… **å„ªé»**:
- å®Œæ•´çš„ä¸­é–“ä»¶æ¶æ§‹ï¼ˆèªè­‰ + éŒ¯èª¤è™•ç†çµ„åˆï¼‰
- çµ±ä¸€çš„éŒ¯èª¤è™•ç†ç³»çµ±
- ç’°å¢ƒè®Šæ•¸é©—è­‰å®Œå–„
- ç¬¦åˆ CLAUDE.md è¦ç¯„ï¼ˆä½¿ç”¨ apiLogger/dbLoggerï¼‰
- Next.js 15 å‹•æ…‹è·¯ç”±åƒæ•¸æ­£ç¢ºè™•ç†ï¼ˆawait paramsï¼‰

âš ï¸ **éœ€æ”¹é€²**:
1. **Token åŠ å¯†å­˜å„²** (Critical)
   - æª”æ¡ˆ: `/src/lib/auth/session-validator.ts:268-274`
   - ç¾ç‹€: access_token å’Œ refresh_token ä»¥æ˜æ–‡å­˜å„²
   - å»ºè­°: å¯¦ä½œ AES-256-GCM åŠ å¯†
   - å„ªå…ˆç´š: ğŸ”´ Criticalï¼ˆä¸Šç·šå‰å¿…é ˆå®Œæˆï¼‰

2. **RLS ç­–ç•¥é…ç½®** (High)
   - ç¾ç‹€: Schema å·²å»ºç«‹ï¼Œä½† RLS ç­–ç•¥æœªåœ¨ SQL ä¸­å®šç¾©
   - å»ºè­°: å»ºç«‹ `/docs/sql/02-setup-rls.sql` æª”æ¡ˆ
   - å„ªå…ˆç´š: ğŸŸ¡ Highï¼ˆå®‰å…¨æ€§è¦æ±‚ï¼‰

---

## éšæ®µ 1: Discord OAuth èªè­‰ï¼ˆWeek 5-8ï¼‰

### å®Œæˆåº¦: 100% âœ…

### è©³ç´°æª¢æŸ¥æ¸…å–®

#### Week 5-6: OAuth æ ¸å¿ƒæµç¨‹

- [x] **å»ºç«‹ Discord Application** - å·²å®Œæˆ
  - ç‹€æ…‹: ç’°å¢ƒè®Šæ•¸é…ç½®å®Œæ•´ï¼ˆ`DISCORD_CLIENT_ID`, `DISCORD_CLIENT_SECRET`, `DISCORD_REDIRECT_URI`ï¼‰

- [x] **å¯¦ä½œ OAuth å•Ÿå‹•**: `GET /api/auth/discord` - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/app/api/auth/discord/route.ts`
  - åŠŸèƒ½:
    - âœ… ç”¢ç”Ÿéš¨æ©Ÿ stateï¼ˆUUIDï¼‰
    - âœ… å°‡ state å­˜å…¥ Redisï¼ˆ10 åˆ†é˜éæœŸï¼‰
    - âœ… é‡å°å‘è‡³ Discord æˆæ¬Šé é¢
    - âœ… ç’°å¢ƒè®Šæ•¸æª¢æŸ¥
  - ç¨‹å¼ç¢¼å“è³ª: âœ… ç¬¦åˆè¦ç¯„ï¼ˆä½¿ç”¨ apiLoggerã€éŒ¯èª¤è™•ç†å®Œæ•´ï¼‰

- [x] **å¯¦ä½œ OAuth å›èª¿**: `GET /api/auth/discord/callback` - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/app/api/auth/discord/callback/route.ts`
  - åŠŸèƒ½:
    - âœ… é©—è­‰ state åƒæ•¸ï¼ˆCSRF é˜²è­·ï¼‰
    - âœ… ç”¨ code äº¤æ› access_token å’Œ refresh_token
    - âœ… ç²å– Discord ç”¨æˆ¶è³‡æ–™
    - âœ… å‰µå»º/æ›´æ–° users è¡¨
    - âœ… åŒæ­¥å‰µå»º discord_profiles è¨˜éŒ„
    - âœ… å»ºç«‹ session ä¸¦è¨­ç½® cookie
    - âœ… æª¢æŸ¥å°ç¦ç‹€æ…‹
  - ç¨‹å¼ç¢¼å“è³ª: âœ… ç¬¦åˆè¦ç¯„ï¼ˆä½¿ç”¨ apiLoggerã€çµ±ä¸€éŒ¯èª¤è™•ç†ã€ValidationErrorï¼‰

- [x] **State token CSRF é˜²è­·** - å·²å®Œæˆ
  - å¯¦ä½œ: Redis å­˜å„² stateï¼ˆ10 åˆ†é˜éæœŸï¼‰
  - é©—è­‰: callback æ™‚æª¢æŸ¥ä¸¦åˆªé™¤ stateï¼ˆä¸€æ¬¡æ€§ä½¿ç”¨ï¼‰

#### Week 7-8: Session ç®¡ç†

- [x] **JWT Token ç”Ÿæˆèˆ‡é©—è­‰** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/lib/auth/session-validator.ts`
  - åŠŸèƒ½:
    - âœ… JWT ç°½åï¼ˆä½¿ç”¨ `SESSION_SECRET`ï¼‰
    - âœ… JWT é©—è­‰ï¼ˆåŒ…å«éæœŸæª¢æŸ¥ï¼‰
    - âœ… Payload åŒ…å« `session_id` å’Œ `user_id`
    - âœ… æœ‰æ•ˆæœŸ 30 å¤©

- [x] **Cookie å®‰å…¨é…ç½®** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/app/api/auth/discord/callback/route.ts:224-230`
  - é…ç½®:
    - âœ… `httpOnly: true`
    - âœ… `secure: process.env.NODE_ENV === 'production'`
    - âœ… `sameSite: 'lax'`
    - âœ… `maxAge: 30 * 24 * 60 * 60` (30 å¤©)
    - âœ… `path: '/'`

- [x] **Session åˆ·æ–°æ©Ÿåˆ¶** - å·²å®Œæˆ
  - å¯¦ä½œ: `validateSession` è‡ªå‹•æ›´æ–° `last_active_at`ï¼ˆéé˜»å¡ï¼‰
  - å‡½æ•¸: `refreshSession` å¯æ‰‹å‹•å‘¼å«

- [x] **ç™»å…¥/ç™»å‡ºåŠŸèƒ½** - å·²å®Œæˆ
  - **ç™»å…¥**: `/api/auth/discord` (GET) â†’ Discord OAuth â†’ callback â†’ session cookie
  - **ç™»å‡º**: `/api/auth/logout` (POST) - å·²å®Œæˆ
    - æª”æ¡ˆ: `/src/app/api/auth/logout/route.ts`
    - åŠŸèƒ½: âœ… æ’¤éŠ· sessionã€âœ… æ¸…é™¤ cookieã€âœ… ä½¿ç”¨ `withAuthAndError` ä¸­é–“ä»¶
  - **ç²å–ç”¨æˆ¶è³‡è¨Š**: `/api/auth/me` (GET) - å·²å®Œæˆ
    - æª”æ¡ˆ: `/src/app/api/auth/me/route.ts`
    - åŠŸèƒ½: âœ… æŸ¥è©¢ç”¨æˆ¶åŸºæœ¬è³‡è¨Šã€âœ… JOIN discord_profilesã€âœ… æŸ¥è©¢ session è³‡è¨Š
    - åŒ…å«: TODO é…é¡æŸ¥è©¢ï¼ˆéšæ®µ 2 å¯¦ä½œï¼‰

#### Token åˆ·æ–° API

- [x] **Token åˆ·æ–°ç«¯é»** - æª”æ¡ˆå­˜åœ¨
  - æª”æ¡ˆ: `/src/app/api/auth/refresh/route.ts`
  - âš ï¸ æœªæª¢æŸ¥å¯¦ä½œå…§å®¹ï¼ˆéœ€è¦æ™‚å†æª¢æŸ¥ï¼‰

#### å‰ç«¯æ•´åˆ

- [x] **AuthContext å¯¦ä½œ** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/contexts/AuthContext.tsx`
  - åŠŸèƒ½:
    - âœ… è‡ªå‹•è¼‰å…¥ç”¨æˆ¶è³‡è¨Šï¼ˆmount æ™‚å‘¼å« `/api/auth/me`ï¼‰
    - âœ… `login()` æ–¹æ³•ï¼ˆå°å‘ `/api/auth/discord`ï¼‰
    - âœ… `logout()` æ–¹æ³•ï¼ˆå‘¼å« `/api/auth/logout`ï¼‰
    - âœ… `refreshUser()` æ–¹æ³•ï¼ˆé‡æ–°è¼‰å…¥ç”¨æˆ¶è³‡è¨Šï¼‰
    - âœ… å…¨åŸŸç‹€æ…‹ç®¡ç†ï¼ˆ`user`, `loading`ï¼‰
  - ç¨‹å¼ç¢¼å“è³ª: âœ… ç¬¦åˆè¦ç¯„ï¼ˆä½¿ç”¨ useCallbackã€éŒ¯èª¤è™•ç†ï¼‰

#### ç¨‹å¼ç¢¼å“è³ªè©•ä¼°

âœ… **å„ªé»**:
- å®Œæ•´çš„ OAuth 2.0 æµç¨‹å¯¦ä½œ
- CSRF é˜²è­·å®Œå–„ï¼ˆstate token + Redisï¼‰
- Session ç®¡ç†æ©Ÿåˆ¶å®Œæ•´
- Cookie å®‰å…¨é…ç½®æ­£ç¢º
- éŒ¯èª¤è™•ç†å®Œå–„ï¼ˆValidationErrorã€çµ±ä¸€å›æ‡‰æ ¼å¼ï¼‰
- ç¬¦åˆ CLAUDE.md è¦ç¯„ï¼ˆapiLoggerã€çµ±ä¸€éŒ¯èª¤è™•ç†ï¼‰

âš ï¸ **éœ€æ”¹é€²**:
1. **Token åŠ å¯†å­˜å„²** (Critical)
   - åŒéšæ®µ 0 çš„ TODOï¼ˆaccess_tokenã€refresh_token æ˜æ–‡å­˜å„²ï¼‰
   - å„ªå…ˆç´š: ğŸ”´ Critical

2. **Token è‡ªå‹•åˆ·æ–°** (Medium)
   - ç¾ç‹€: `validateSession` æ›´æ–° `last_active_at`ï¼Œä½†æœªæª¢æŸ¥ `token_expires_at`
   - å»ºè­°: å¯¦ä½œ Token åˆ·æ–°é‚è¼¯ï¼ˆå‰©é¤˜æ™‚é–“ < 25% è‡ªå‹•åˆ·æ–°ï¼‰
   - å„ªå…ˆç´š: ğŸŸ¡ Mediumï¼ˆå¯åœ¨éšæ®µ 3 å¯¦ä½œï¼‰

---

## éšæ®µ 2: æ ¸å¿ƒåŠŸèƒ½ï¼ˆWeek 9-12ï¼‰

### å®Œæˆåº¦: 70% âš ï¸

### è©³ç´°æª¢æŸ¥æ¸…å–®

#### Week 9-10: åˆŠç™»ç³»çµ±

- [x] **å¯¦ä½œåˆŠç™» CRUD API** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/app/api/listings/route.ts`
  - ç«¯é»:
    - âœ… `GET /api/listings` - æŸ¥è©¢æˆ‘çš„åˆŠç™»
      - åŠŸèƒ½: ç¯©é¸ï¼ˆstatus, trade_typeï¼‰ã€æ’åºã€RLS éæ¿¾
    - âœ… `POST /api/listings` - å»ºç«‹åˆŠç™»
      - åŠŸèƒ½: é©—è­‰æ¬„ä½ã€æª¢æŸ¥é…é¡ï¼ˆæœ€å¤š 50 å€‹ activeï¼‰ã€æ’å…¥è³‡æ–™
  - æª”æ¡ˆ: `/src/app/api/listings/[id]/route.ts`
    - âš ï¸ æœªæª¢æŸ¥å¯¦ä½œå…§å®¹ï¼ˆPATCH/DELETEï¼‰
  - æª”æ¡ˆ: `/src/app/api/listings/[id]/contact/route.ts`
    - âš ï¸ æœªæª¢æŸ¥å¯¦ä½œå…§å®¹ï¼ˆæŸ¥çœ‹è¯çµ¡æ–¹å¼ï¼‰

- [x] **å¯¦ä½œèªè­‰ä¸­é–“ä»¶** - å·²å®Œæˆ
  - ä½¿ç”¨: `withAuthAndError` ä¸­é–“ä»¶
  - ç¬¦åˆ: CLAUDE.md è¦ç¯„

- [x] **å»ºç«‹åˆŠç™» Modal å…ƒä»¶** - éƒ¨åˆ†å®Œæˆ âš ï¸
  - æª”æ¡ˆ: `/src/components/trade/CreateListingModal.tsx`
  - åŠŸèƒ½:
    - âœ… äº¤æ˜“é¡å‹é¸æ“‡ï¼ˆsell, buy, exchangeï¼‰
    - âœ… ä½¿ç”¨ `ItemSearchInput` é¸æ“‡ç‰©å“
    - âœ… exchange æ¨¡å¼æ”¯æ´é¸æ“‡æƒ³è¦çš„ç‰©å“
    - âœ… è¼¸å…¥åƒ¹æ ¼/æ•¸é‡
    - âœ… é¸æ“‡è¯çµ¡æ–¹å¼ï¼ˆdiscord, ingameï¼‰
    - âœ… è¡¨å–®é©—è­‰
    - âœ… å‘¼å« `POST /api/listings`
    - âœ… æˆåŠŸå¾Œé—œé–‰ Modal ä¸¦åˆ·æ–°åˆ—è¡¨
  - åŒ…å« TODO è¨»è§£:
    - âŒ Line 210: `{/* TODO: é¸æ“‡ç‰©å“ */}` - å¯¦éš›å·²å¯¦ä½œ
    - âŒ Line 224: `{/* TODO: äº¤æ›æ¨¡å¼ - é¸æ“‡æƒ³è¦çš„ç‰©å“ */}` - å¯¦éš›å·²å¯¦ä½œ
    - âŒ Line 237: `{/* TODO: æ•¸é‡å’Œåƒ¹æ ¼ */}` - å¯¦éš›å·²å¯¦ä½œ
    - âŒ Line 265: `{/* TODO: è¯çµ¡æ–¹å¼ */}` - å¯¦éš›å·²å¯¦ä½œ
  - **è©•ä¼°**: TODO è¨»è§£ç‚ºæ­·å²éºç•™ï¼Œå¯¦éš›åŠŸèƒ½å·²å®Œæ•´å¯¦ä½œ

#### Week 11-12: å¸‚å ´èˆ‡æ„å‘

- [x] **å¯¦ä½œå¸‚å ´åˆ—è¡¨ API** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/app/api/market/route.ts`
  - ç«¯é»: `GET /api/market`
  - åŠŸèƒ½:
    - âœ… æŸ¥è©¢ status = 'active' çš„åˆŠç™»
    - âœ… ç¯©é¸ï¼ˆtrade_type, item_idï¼‰
    - âœ… åˆ†é æ”¯æ´ï¼ˆpage, limit, é è¨­ 20, æœ€å¤§ 50ï¼‰
    - âœ… JOIN users å’Œ discord_profilesï¼ˆè³£å®¶è³‡è¨Šã€ä¿¡è­½åˆ†æ•¸ï¼‰
    - âœ… ä½¿ç”¨ `successWithPagination` å›æ‡‰æ ¼å¼
  - ç¨‹å¼ç¢¼å“è³ª: âœ… ç¬¦åˆè¦ç¯„ï¼ˆwithAuthAndErrorã€apiLoggerï¼‰

- [ ] **å¯¦ä½œå¸‚å ´æœå°‹ API** - æœªå¯¦ä½œ âŒ
  - æª”æ¡ˆ: `/src/app/api/market/search/route.ts`
  - ç‹€æ…‹: **è¿”å› 501 Not Implemented**
  - å…§å®¹: `// TODO [éšæ®µ 1]: å¯¦ä½œå¸‚å ´æœå°‹/ç¯©é¸`
  - å„ªå…ˆç´š: ğŸŸ¡ Mediumï¼ˆå¯ä½¿ç”¨ `/api/market?item_id=123` æ›¿ä»£åŸºæœ¬æœå°‹ï¼‰

- [ ] **å¯¦ä½œç†±é–€å•†å“ API** - æœªå¯¦ä½œ âŒ
  - æª”æ¡ˆ: `/src/app/api/market/trending/route.ts`
  - ç‹€æ…‹: **è¿”å› 501 Not Implemented**
  - å…§å®¹: `// TODO [éšæ®µ 1]: å¯¦ä½œç†±é–€å•†å“åˆ—è¡¨ (å…¬é–‹ç«¯é»)`
  - å„ªå…ˆç´š: ğŸŸ¢ Lowï¼ˆå¢å¼·åŠŸèƒ½ï¼Œéæ ¸å¿ƒï¼‰

- [ ] **å¯¦ä½œäº¤æ›åŒ¹é…ç®—æ³•** - æœªå¯¦ä½œ âŒ
  - æª”æ¡ˆ: `/src/app/api/market/exchange-matches/route.ts`
  - ç‹€æ…‹: **æª”æ¡ˆå­˜åœ¨ä½†æœªæª¢æŸ¥**
  - å„ªå…ˆç´š: ğŸŸ¡ Mediumï¼ˆäº¤æ›åŠŸèƒ½çš„é—œéµï¼‰

- [x] **å¯¦ä½œè³¼è²·æ„å‘ API** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/app/api/interests/route.ts`
  - ç«¯é»:
    - âœ… `GET /api/interests` - æŸ¥è©¢æˆ‘çš„è³¼è²·æ„å‘
      - åŠŸèƒ½: ç‹€æ…‹ç¯©é¸ã€JOIN listings è¡¨
    - âœ… `POST /api/interests` - ç™»è¨˜è³¼è²·æ„å‘
      - åŠŸèƒ½: é©—è­‰åˆŠç™»å­˜åœ¨ã€é˜²æ­¢é‡è¤‡ç™»è¨˜ã€æ›´æ–° interest_countã€é˜²æ­¢å°è‡ªå·±åˆŠç™»ç™»è¨˜
  - ç¨‹å¼ç¢¼å“è³ª: âœ… ç¬¦åˆè¦ç¯„ï¼ˆwithAuthAndErrorã€apiLoggerã€ValidationErrorï¼‰

- [x] **æŸ¥è©¢æ”¶åˆ°çš„æ„å‘ API** - å·²å®Œæˆ
  - æª”æ¡ˆ: `/src/app/api/interests/received/route.ts`
  - âš ï¸ æœªæª¢æŸ¥å¯¦ä½œå…§å®¹

- [ ] **å»ºç«‹å¸‚å ´ç€è¦½ Modal** - éƒ¨åˆ†å®Œæˆ âš ï¸
  - æª”æ¡ˆ: `/src/components/trade/MarketBrowserModal.tsx`
  - âš ï¸ æœªæª¢æŸ¥å¯¦ä½œå…§å®¹ï¼ˆéœ€è¦æ™‚å†æª¢æŸ¥ï¼‰
  - é æœŸåŠŸèƒ½: å•†å“åˆ—è¡¨å±•ç¤ºã€åˆ†é /ç¯©é¸ã€åˆŠç™»è©³æƒ…å­ Modalã€è³¼è²·æ„å‘ç™»è¨˜

#### ç¨‹å¼ç¢¼å“è³ªè©•ä¼°

âœ… **å„ªé»**:
- æ ¸å¿ƒ API å…¨éƒ¨å¯¦ä½œï¼ˆåˆŠç™» CRUDã€å¸‚å ´åˆ—è¡¨ã€è³¼è²·æ„å‘ï¼‰
- åˆ†é æ©Ÿåˆ¶å®Œæ•´ï¼ˆ`successWithPagination`ï¼‰
- è³‡æ–™é©—è­‰å®Œå–„ï¼ˆé…é¡é™åˆ¶ã€é˜²æ­¢é‡è¤‡ã€é˜²æ­¢è‡ªå·±å°è‡ªå·±ï¼‰
- ç¬¦åˆ CLAUDE.md è¦ç¯„ï¼ˆwithAuthAndErrorã€apiLoggerã€çµ±ä¸€éŒ¯èª¤è™•ç†ï¼‰
- Next.js 15 å‹•æ…‹è·¯ç”±åƒæ•¸æ­£ç¢ºè™•ç†

âš ï¸ **éœ€æ”¹é€²**:
1. **å¸‚å ´æœå°‹åŠŸèƒ½** (Medium)
   - æª”æ¡ˆ: `/src/app/api/market/search/route.ts`
   - ç¾ç‹€: è¿”å› 501 Not Implemented
   - å»ºè­°: å¯¦ä½œé—œéµå­—æœå°‹ã€åƒ¹æ ¼ç¯„åœç¯©é¸
   - å„ªå…ˆç´š: ğŸŸ¡ Mediumï¼ˆå¯æš«æ™‚ä½¿ç”¨ `/api/market?item_id=` æ›¿ä»£ï¼‰

2. **äº¤æ›åŒ¹é…ç®—æ³•** (Medium)
   - æª”æ¡ˆ: `/src/app/api/market/exchange-matches/route.ts`
   - ç¾ç‹€: æœªæª¢æŸ¥
   - å»ºè­°: å¯¦ä½œåŒ¹é…é‚è¼¯ï¼ˆA æœ‰ X æƒ³è¦ Yï¼ŒB æœ‰ Y æƒ³è¦ Xï¼‰
   - å„ªå…ˆç´š: ğŸŸ¡ Mediumï¼ˆäº¤æ›åŠŸèƒ½çš„é—œéµï¼‰

3. **æ¸…ç† TODO è¨»è§£** (Low)
   - æª”æ¡ˆ: `/src/components/trade/CreateListingModal.tsx`
   - ç¾ç‹€: åŒ…å« 4 å€‹å·²å¯¦ä½œåŠŸèƒ½çš„ TODO è¨»è§£
   - å»ºè­°: ç§»é™¤æˆ–æ›´æ–°è¨»è§£
   - å„ªå…ˆç´š: ğŸŸ¢ Lowï¼ˆä¸å½±éŸ¿åŠŸèƒ½ï¼‰

4. **ç†±é–€å•†å“åˆ—è¡¨** (Low)
   - æª”æ¡ˆ: `/src/app/api/market/trending/route.ts`
   - ç¾ç‹€: è¿”å› 501 Not Implemented
   - å»ºè­°: å¯¦ä½œåŸºæ–¼ view_count æˆ– interest_count çš„æ’åº
   - å„ªå…ˆç´š: ğŸŸ¢ Lowï¼ˆå¢å¼·åŠŸèƒ½ï¼‰

---

## TODO è¨»è§£çµ±è¨ˆ

### API ç›¸é—œ TODO

| æª”æ¡ˆ | è¡Œè™Ÿ | å…§å®¹ | ç‹€æ…‹ | å„ªå…ˆç´š |
|------|------|------|------|--------|
| `/src/lib/auth/session-validator.ts` | 268 | `TODO [éšæ®µ 1]: å¯¦ä½œ AES-256-GCM åŠ å¯†å­˜å„²` | âŒ æœªå¯¦ä½œ | ğŸ”´ Critical |
| `/src/lib/auth/session-validator.ts` | 273-274 | `// TODO: åŠ å¯†` (access_token, refresh_token) | âŒ æœªå¯¦ä½œ | ğŸ”´ Critical |
| `/src/app/api/auth/me/route.ts` | 160 | `TODO [éšæ®µ 2]: å¯¦ä½œé…é¡æŸ¥è©¢` | âŒ æœªå¯¦ä½œ | ğŸŸ¡ Medium |
| `/src/app/api/market/search/route.ts` | 4 | `TODO [éšæ®µ 1]: å¯¦ä½œå¸‚å ´æœå°‹/ç¯©é¸` | âŒ æœªå¯¦ä½œ | ğŸŸ¡ Medium |
| `/src/app/api/market/trending/route.ts` | 4 | `TODO [éšæ®µ 1]: å¯¦ä½œç†±é–€å•†å“åˆ—è¡¨` | âŒ æœªå¯¦ä½œ | ğŸŸ¢ Low |
| `/src/app/api/reputation/calculate/route.ts` | 4 | `TODO [éšæ®µ 3]: å¯¦ä½œé‡æ–°è¨ˆç®—ä¿¡è­½` | âŒ æœªå¯¦ä½œ | âšª éšæ®µ 3 |
| `/src/app/api/reputation/[userId]/route.ts` | 4 | `TODO [éšæ®µ 3]: å¯¦ä½œç²å–ç”¨æˆ¶ä¿¡è­½` | âŒ æœªå¯¦ä½œ | âšª éšæ®µ 3 |

### å‰ç«¯å…ƒä»¶ TODO

| æª”æ¡ˆ | è¡Œè™Ÿ | å…§å®¹ | ç‹€æ…‹ | å„ªå…ˆç´š |
|------|------|------|------|--------|
| `/src/components/trade/CreateListingModal.tsx` | 210 | `{/* TODO: é¸æ“‡ç‰©å“ */}` | âœ… å·²å¯¦ä½œ | ğŸŸ¢ ä½ï¼ˆæ¸…ç†è¨»è§£ï¼‰ |
| `/src/components/trade/CreateListingModal.tsx` | 224 | `{/* TODO: äº¤æ›æ¨¡å¼ - é¸æ“‡æƒ³è¦çš„ç‰©å“ */}` | âœ… å·²å¯¦ä½œ | ğŸŸ¢ ä½ï¼ˆæ¸…ç†è¨»è§£ï¼‰ |
| `/src/components/trade/CreateListingModal.tsx` | 237 | `{/* TODO: æ•¸é‡å’Œåƒ¹æ ¼ */}` | âœ… å·²å¯¦ä½œ | ğŸŸ¢ ä½ï¼ˆæ¸…ç†è¨»è§£ï¼‰ |
| `/src/components/trade/CreateListingModal.tsx` | 265 | `{/* TODO: è¯çµ¡æ–¹å¼ */}` | âœ… å·²å¯¦ä½œ | ğŸŸ¢ ä½ï¼ˆæ¸…ç†è¨»è§£ï¼‰ |
| `/src/components/trade/InterestsModal.tsx` | 20 | `TODO: æ¨™è¨˜å·²è¯çµ¡/å·²å®ŒæˆæŒ‰éˆ• (éšæ®µ 2 é¸åš)` | âŒ æœªå¯¦ä½œ | ğŸŸ¢ Lowï¼ˆå¢å¼·åŠŸèƒ½ï¼‰ |
| `/src/components/trade/ListingDetailModal.tsx` | 20-21 | `TODO: èˆ‰å ±æŒ‰éˆ•/äº¤æ›åŒ¹é…æŒ‰éˆ•` | âŒ æœªå¯¦ä½œ | ğŸŸ¡ Medium |

### ç¸½è¨ˆ

- **Critical (ğŸ”´)**: 2 é …ï¼ˆToken åŠ å¯†å­˜å„²ï¼‰
- **Medium (ğŸŸ¡)**: 4 é …ï¼ˆé…é¡æŸ¥è©¢ã€å¸‚å ´æœå°‹ã€äº¤æ›åŒ¹é…ã€è©³æƒ… Modalï¼‰
- **Low (ğŸŸ¢)**: 6 é …ï¼ˆæ¸…ç†è¨»è§£ã€ç†±é–€å•†å“ã€å¢å¼·åŠŸèƒ½ï¼‰
- **éšæ®µ 3+ (âšª)**: 2 é …ï¼ˆä¿¡è­½ç³»çµ±ï¼‰

---

## é˜»å¡å•é¡Œæ¸…å–®

### ğŸ”´ Critical ç´šåˆ¥ï¼ˆä¸Šç·šå‰å¿…é ˆè§£æ±ºï¼‰

1. **Token åŠ å¯†å­˜å„²**
   - **æª”æ¡ˆ**: `/src/lib/auth/session-validator.ts:268-274`
   - **å•é¡Œ**: `access_token` å’Œ `refresh_token` ä»¥æ˜æ–‡å­˜å„²åœ¨ Supabase `sessions` è¡¨
   - **é¢¨éšª**: è³‡æ–™åº«æ´©æ¼æœƒç›´æ¥æš´éœ² Discord token
   - **è§£æ±ºæ–¹æ¡ˆ**:
     1. å®‰è£åŠ å¯†å¥—ä»¶: `npm install @noble/ciphers`
     2. å¯¦ä½œ AES-256-GCM åŠ å¯†/è§£å¯†å‡½æ•¸
     3. æ›´æ–° `createSession` å‡½æ•¸ï¼ˆåŠ å¯†å¾Œå†å­˜å„²ï¼‰
     4. æ›´æ–° Token åˆ·æ–°é‚è¼¯ï¼ˆå…ˆè§£å¯†å†ä½¿ç”¨ï¼‰
   - **æ™‚ç¨‹**: 1-2 å¤©
   - **åƒè€ƒ**: [docs/architecture/äº¤æ˜“ç³»çµ±/05-å®‰å…¨èˆ‡å¯é æ€§.md]

### ğŸŸ¡ High ç´šåˆ¥ï¼ˆåŠŸèƒ½å®Œæ•´æ€§ï¼‰

2. **RLS ç­–ç•¥é…ç½®**
   - **æª”æ¡ˆ**: Supabase Dashboard æˆ–æ–°å»º `/docs/sql/02-setup-rls.sql`
   - **å•é¡Œ**: Schema å·²å»ºç«‹ï¼Œä½† RLS ç­–ç•¥æœªå®šç¾©
   - **é¢¨éšª**: è³‡æ–™åº«å­˜å–æ¬Šé™ä¸å—æ§åˆ¶
   - **è§£æ±ºæ–¹æ¡ˆ**:
     1. ç‚ºæ¯å€‹è¡¨å®šç¾© RLS ç­–ç•¥ï¼ˆusers, listings, interests, sessionsï¼‰
     2. ä½¿ç”¨ `auth.uid()` é™åˆ¶å­˜å–ï¼ˆä¾‹ï¼šåªèƒ½æŸ¥è©¢/ä¿®æ”¹è‡ªå·±çš„åˆŠç™»ï¼‰
     3. åœ¨ Supabase Dashboard å•Ÿç”¨ RLS
   - **æ™‚ç¨‹**: åŠå¤©
   - **åƒè€ƒ**: [Supabase RLS Documentation](https://supabase.com/docs/guides/auth/row-level-security)

3. **å¸‚å ´æœå°‹åŠŸèƒ½**
   - **æª”æ¡ˆ**: `/src/app/api/market/search/route.ts`
   - **å•é¡Œ**: è¿”å› 501 Not Implemented
   - **å½±éŸ¿**: ç”¨æˆ¶ç„¡æ³•æœå°‹ç‰¹å®šç‰©å“ï¼ˆåªèƒ½ç€è¦½å…¨éƒ¨åˆ—è¡¨ï¼‰
   - **è§£æ±ºæ–¹æ¡ˆ**:
     1. å¯¦ä½œé—œéµå­—æœå°‹ï¼ˆitem_id, trade_typeï¼‰
     2. åƒ¹æ ¼ç¯„åœç¯©é¸ï¼ˆprice_min, price_maxï¼‰
     3. æ”¯æ´åˆ†é å’Œæ’åº
   - **æ™‚ç¨‹**: 1 å¤©
   - **å‚™è¨»**: ç›®å‰å¯æš«æ™‚ä½¿ç”¨ `/api/market?item_id=123` ä½œç‚ºæ›¿ä»£æ–¹æ¡ˆ

4. **äº¤æ›åŒ¹é…ç®—æ³•**
   - **æª”æ¡ˆ**: `/src/app/api/market/exchange-matches/route.ts`
   - **å•é¡Œ**: æœªæª¢æŸ¥å¯¦ä½œç‹€æ…‹ï¼ˆå¯èƒ½æœªå¯¦ä½œï¼‰
   - **å½±éŸ¿**: äº¤æ›åŠŸèƒ½ç„¡æ³•è‡ªå‹•åŒ¹é…ï¼ˆç”¨æˆ¶éœ€æ‰‹å‹•æœå°‹ï¼‰
   - **è§£æ±ºæ–¹æ¡ˆ**:
     1. æŸ¥è©¢ `wanted_item_id` åŒ¹é…çš„åˆŠç™»
     2. åå‘æŸ¥è©¢ï¼ˆA æœ‰ X æƒ³è¦ Yï¼ŒB æœ‰ Y æƒ³è¦ Xï¼‰
     3. è¿”å›åŒ¹é…çµæœåˆ—è¡¨
   - **æ™‚ç¨‹**: 2 å¤©
   - **åƒè€ƒ**: [docs/architecture/äº¤æ˜“ç³»çµ±/03-APIè¨­è¨ˆ.md]

### ğŸŸ¢ Medium ç´šåˆ¥ï¼ˆå¢å¼·åŠŸèƒ½ï¼‰

5. **é…é¡æŸ¥è©¢å¯¦ä½œ**
   - **æª”æ¡ˆ**: `/src/app/api/auth/me/route.ts:160-174`
   - **å•é¡Œ**: åŒ…å« TODO è¨»è§£ï¼Œé…é¡æŸ¥è©¢æœªå¯¦ä½œ
   - **å½±éŸ¿**: å‰ç«¯ç„¡æ³•é¡¯ç¤ºç”¨æˆ¶é…é¡ä½¿ç”¨æƒ…æ³
   - **è§£æ±ºæ–¹æ¡ˆ**:
     1. æŸ¥è©¢ `active_listings_count`ï¼ˆCOUNT queryï¼‰
     2. æŸ¥è©¢ `interests_today`ï¼ˆæ ¹æ“š created_at ç¯©é¸ï¼‰
     3. è¿”å›é…é¡è³‡è¨Š
   - **æ™‚ç¨‹**: åŠå¤©

6. **æ¸…ç† TODO è¨»è§£**
   - **æª”æ¡ˆ**: `/src/components/trade/CreateListingModal.tsx`
   - **å•é¡Œ**: åŒ…å« 4 å€‹å·²å¯¦ä½œåŠŸèƒ½çš„ TODO è¨»è§£
   - **å½±éŸ¿**: ç„¡ï¼ˆä¸å½±éŸ¿åŠŸèƒ½ï¼Œåƒ…å½±éŸ¿ç¨‹å¼ç¢¼å¯è®€æ€§ï¼‰
   - **è§£æ±ºæ–¹æ¡ˆ**: ç§»é™¤æ­·å²éºç•™çš„ TODO è¨»è§£
   - **æ™‚ç¨‹**: 10 åˆ†é˜

---

## ä¸‹ä¸€æ­¥å»ºè­°

### ğŸ”´ Critical å„ªå…ˆç´šï¼ˆç«‹å³åŸ·è¡Œï¼‰

1. **å¯¦ä½œ Token åŠ å¯†å­˜å„²**
   - **æ™‚ç¨‹**: 1-2 å¤©
   - **åŸ·è¡Œæ­¥é©Ÿ**:
     1. å®‰è£å¥—ä»¶: `npm install @noble/ciphers`
     2. å»ºç«‹åŠ å¯†å·¥å…·: `/src/lib/auth/token-encryption.ts`
     3. å¯¦ä½œ `encryptToken` å’Œ `decryptToken` å‡½æ•¸
     4. æ›´æ–° `createSession` å’Œ Token åˆ·æ–°é‚è¼¯
     5. æ¸¬è©¦ï¼šå»ºç«‹ session â†’ æª¢æŸ¥è³‡æ–™åº«ï¼ˆç¢ºèªå·²åŠ å¯†ï¼‰â†’ validateSessionï¼ˆç¢ºèªèƒ½æ­£å¸¸è§£å¯†ï¼‰
   - **é©—æ”¶æ¨™æº–**: è³‡æ–™åº«ä¸­çš„ `access_token` å’Œ `refresh_token` ç‚ºåŠ å¯†å­—ä¸²

2. **é…ç½® RLS ç­–ç•¥**
   - **æ™‚ç¨‹**: åŠå¤©
   - **åŸ·è¡Œæ­¥é©Ÿ**:
     1. å»ºç«‹ SQL æª”æ¡ˆ: `/docs/sql/02-setup-rls.sql`
     2. ç‚ºæ¯å€‹è¡¨å®šç¾©ç­–ç•¥ï¼ˆSELECT, INSERT, UPDATE, DELETEï¼‰
     3. åœ¨ Supabase Dashboard åŸ·è¡Œ SQL
     4. æ¸¬è©¦ï¼šä½¿ç”¨éæ“æœ‰è€…å¸³è™Ÿå˜—è©¦å­˜å–ä»–äººåˆŠç™»ï¼ˆæ‡‰å¤±æ•—ï¼‰
   - **é©—æ”¶æ¨™æº–**: RLS å•Ÿç”¨ä¸”æ¸¬è©¦é€šé

### ğŸŸ¡ High å„ªå…ˆç´šï¼ˆæœ¬é€±å…§å®Œæˆï¼‰

3. **å¯¦ä½œå¸‚å ´æœå°‹åŠŸèƒ½**
   - **æ™‚ç¨‹**: 1 å¤©
   - **åŸ·è¡Œæ­¥é©Ÿ**:
     1. ç·¨è¼¯ `/src/app/api/market/search/route.ts`
     2. å¯¦ä½œæŸ¥è©¢é‚è¼¯ï¼ˆitem_id, price_min, price_max, trade_typeï¼‰
     3. æ¸¬è©¦ï¼šæœå°‹ç‰¹å®šç‰©å“ã€åƒ¹æ ¼ç¯„åœç¯©é¸
   - **é©—æ”¶æ¨™æº–**: è¿”å›æ­£ç¢ºçš„æœå°‹çµæœ

4. **å¯¦ä½œäº¤æ›åŒ¹é…ç®—æ³•**
   - **æ™‚ç¨‹**: 2 å¤©
   - **åŸ·è¡Œæ­¥é©Ÿ**:
     1. ç·¨è¼¯ `/src/app/api/market/exchange-matches/route.ts`
     2. å¯¦ä½œé›™å‘åŒ¹é…é‚è¼¯
     3. æ¸¬è©¦ï¼šå»ºç«‹ A æœ‰ X æƒ³è¦ Yã€B æœ‰ Y æƒ³è¦ Xï¼Œç¢ºèªèƒ½åŒ¹é…
   - **é©—æ”¶æ¨™æº–**: è¿”å›åŒ¹é…çµæœåˆ—è¡¨

5. **å¯¦ä½œé…é¡æŸ¥è©¢**
   - **æ™‚ç¨‹**: åŠå¤©
   - **åŸ·è¡Œæ­¥é©Ÿ**:
     1. ç·¨è¼¯ `/src/app/api/auth/me/route.ts`
     2. å¯¦ä½œé…é¡æŸ¥è©¢é‚è¼¯
     3. æ¸¬è©¦ï¼šå»ºç«‹åˆŠç™»å¾Œå†å‘¼å« `/api/auth/me?include_quotas=true`ï¼Œç¢ºèªé…é¡æ­£ç¢º
   - **é©—æ”¶æ¨™æº–**: è¿”å›æ­£ç¢ºçš„é…é¡è³‡è¨Š

### ğŸŸ¢ Medium å„ªå…ˆç´šï¼ˆé¸åšï¼‰

6. **æ¸…ç† TODO è¨»è§£**
   - **æ™‚ç¨‹**: 10 åˆ†é˜
   - **åŸ·è¡Œæ­¥é©Ÿ**:
     1. ç·¨è¼¯ `/src/components/trade/CreateListingModal.tsx`
     2. ç§»é™¤ Line 210, 224, 237, 265 çš„ TODO è¨»è§£
   - **é©—æ”¶æ¨™æº–**: ç„¡ TODO è¨»è§£

7. **å¯¦ä½œç†±é–€å•†å“åˆ—è¡¨**
   - **æ™‚ç¨‹**: 1 å¤©
   - **åŸ·è¡Œæ­¥é©Ÿ**:
     1. ç·¨è¼¯ `/src/app/api/market/trending/route.ts`
     2. å¯¦ä½œåŸºæ–¼ `view_count` æˆ– `interest_count` çš„æ’åº
     3. æ¸¬è©¦ï¼šè¿”å›å‰ 10 å€‹ç†±é–€å•†å“
   - **é©—æ”¶æ¨™æº–**: è¿”å›æ’åºå¾Œçš„å•†å“åˆ—è¡¨

---

## æ™‚ç¨‹è©•ä¼°

### å®Œæˆéšæ®µ 2 å‰©é¤˜ä»»å‹™

| ä»»å‹™ | å„ªå…ˆç´š | æ™‚ç¨‹ | è² è²¬äºº | å‚™è¨» |
|------|--------|------|--------|------|
| Token åŠ å¯†å­˜å„² | ğŸ”´ Critical | 1-2 å¤© | Backend | ä¸Šç·šå‰å¿…é ˆå®Œæˆ |
| RLS ç­–ç•¥é…ç½® | ğŸ”´ Critical | 0.5 å¤© | Backend | ä¸Šç·šå‰å¿…é ˆå®Œæˆ |
| å¸‚å ´æœå°‹åŠŸèƒ½ | ğŸŸ¡ High | 1 å¤© | Backend | åŠŸèƒ½å®Œæ•´æ€§ |
| äº¤æ›åŒ¹é…ç®—æ³• | ğŸŸ¡ High | 2 å¤© | Backend | åŠŸèƒ½å®Œæ•´æ€§ |
| é…é¡æŸ¥è©¢ | ğŸŸ¡ High | 0.5 å¤© | Backend | åŠŸèƒ½å®Œæ•´æ€§ |
| æ¸…ç† TODO è¨»è§£ | ğŸŸ¢ Medium | 0.1 å¤© | Frontend | å¯è®€æ€§å„ªåŒ– |
| ç†±é–€å•†å“åˆ—è¡¨ | ğŸŸ¢ Low | 1 å¤© | Backend | å¢å¼·åŠŸèƒ½ |

**ç¸½è¨ˆ**: 5-7 å¤©ï¼ˆä¸åŒ…å«æ¸¬è©¦å’Œ Bug ä¿®å¾©ï¼‰

### å®Œæ•´ MVP æ™‚ç¨‹é ä¼°

- **éšæ®µ 0-1ï¼ˆå·²å®Œæˆï¼‰**: Week 1-8 âœ…
- **éšæ®µ 2ï¼ˆå‰©é¤˜ä»»å‹™ï¼‰**: **1 é€±**ï¼ˆCritical + Highï¼‰
- **éšæ®µ 3ï¼ˆä¸Šç·šè§€å¯Ÿï¼‰**: 2 é€±
- **ç¸½è¨ˆ**: **ç•¶å‰ + 1 é€±** å¯å®Œæˆæ ¸å¿ƒåŠŸèƒ½

### ç”Ÿç”¢å°±ç·’ç‰ˆæœ¬æ™‚ç¨‹

- **éšæ®µ 0-2ï¼ˆå®Œæ•´ï¼‰**: ç•¶å‰ + 1 é€±
- **éšæ®µ 3ï¼ˆä¸Šç·šè§€å¯Ÿï¼‰**: 2 é€±
- **ç¸½è¨ˆ**: **ç•¶å‰ + 3 é€±** å¯ä¸Šç·šç”Ÿç”¢ç’°å¢ƒ

---

## å…·é«”å»ºè­°

### 1. ç«‹å³åŸ·è¡Œï¼ˆæœ¬é€±ï¼‰

**å„ªå…ˆé †åº**:
1. Token åŠ å¯†å­˜å„²ï¼ˆCriticalï¼‰
2. RLS ç­–ç•¥é…ç½®ï¼ˆCriticalï¼‰
3. å¸‚å ´æœå°‹åŠŸèƒ½ï¼ˆHighï¼‰

**åŸ·è¡Œè¨ˆåŠƒ**:
```
Day 1-2: Token åŠ å¯†å­˜å„²
Day 3: RLS ç­–ç•¥é…ç½®
Day 4-5: å¸‚å ´æœå°‹åŠŸèƒ½
Day 6-7: æ¸¬è©¦å’Œ Bug ä¿®å¾©
```

### 2. ä¸‹é€±åŸ·è¡Œ

**å„ªå…ˆé †åº**:
1. äº¤æ›åŒ¹é…ç®—æ³•ï¼ˆHighï¼‰
2. é…é¡æŸ¥è©¢ï¼ˆHighï¼‰
3. æ¸…ç† TODO è¨»è§£ï¼ˆMediumï¼‰

**åŸ·è¡Œè¨ˆåŠƒ**:
```
Day 1-2: äº¤æ›åŒ¹é…ç®—æ³•
Day 3: é…é¡æŸ¥è©¢
Day 4: æ¸…ç† TODO è¨»è§£
Day 5: æ•´åˆæ¸¬è©¦
```

### 3. éšæ®µ 3 æº–å‚™

**ä¸Šç·šå‰æª¢æŸ¥æ¸…å–®**:
- [ ] æ‰€æœ‰ Critical ç´šåˆ¥å•é¡Œå·²è§£æ±º
- [ ] æ ¸å¿ƒ API åŠŸèƒ½å®Œæ•´ï¼ˆåˆŠç™»ã€å¸‚å ´ã€æ„å‘ã€æœå°‹ã€åŒ¹é…ï¼‰
- [ ] RLS ç­–ç•¥å•Ÿç”¨ä¸¦æ¸¬è©¦é€šé
- [ ] Token åŠ å¯†å­˜å„²å·²å¯¦ä½œ
- [ ] å‰ç«¯ UI å…ƒä»¶åŠŸèƒ½å®Œæ•´
- [ ] éŒ¯èª¤è™•ç†å®Œå–„
- [ ] ç’°å¢ƒè®Šæ•¸é…ç½®å®Œæ•´ï¼ˆProductionï¼‰
- [ ] æ•ˆèƒ½æ¸¬è©¦é€šéï¼ˆAPI å›æ‡‰æ™‚é–“ < 200msï¼‰
- [ ] å®‰å…¨æª¢æŸ¥é€šéï¼ˆXSS, CSRF, SQL Injectionï¼‰

### 4. æŠ€è¡“å‚µç®¡ç†

**å„ªå…ˆè™•ç†**:
1. Token åŠ å¯†å­˜å„²ï¼ˆCriticalï¼‰
2. RLS ç­–ç•¥é…ç½®ï¼ˆCriticalï¼‰
3. æ¸…ç† TODO è¨»è§£ï¼ˆLowï¼Œä½†æ˜“æ–¼å®Œæˆï¼‰

**å»¶å¾Œè™•ç†**:
1. ç†±é–€å•†å“åˆ—è¡¨ï¼ˆå¢å¼·åŠŸèƒ½ï¼Œéæ ¸å¿ƒï¼‰
2. ä¿¡è­½ç³»çµ±ï¼ˆéšæ®µ 3+ï¼‰
3. Webhook é€šçŸ¥ï¼ˆéšæ®µ 4ï¼‰

---

## ç¸½çµ

### ç•¶å‰ç‹€æ…‹

- **éšæ®µ 0ï¼ˆåŸºç¤æ¶æ§‹ï¼‰**: âœ… **100% å®Œæˆ**ï¼ˆSupabase + Redis + ä¸­é–“ä»¶ + Session ç®¡ç†ï¼‰
- **éšæ®µ 1ï¼ˆDiscord OAuthï¼‰**: âœ… **100% å®Œæˆ**ï¼ˆå®Œæ•´èªè­‰æµç¨‹ + AuthContextï¼‰
- **éšæ®µ 2ï¼ˆæ ¸å¿ƒåŠŸèƒ½ï¼‰**: âš ï¸ **70% å®Œæˆ**ï¼ˆåˆŠç™»/å¸‚å ´/æ„å‘ API å®Œæˆï¼Œéƒ¨åˆ†åŠŸèƒ½éœ€è£œé½Šï¼‰

### å„ªå‹¢

1. **æ¶æ§‹å®Œæ•´**: ä¸­é–“ä»¶ã€éŒ¯èª¤è™•ç†ã€æ—¥èªŒç³»çµ±ã€çµ±ä¸€å›æ‡‰æ ¼å¼
2. **èªè­‰å®Œå–„**: Discord OAuth 2.0 å®Œæ•´å¯¦ä½œï¼ŒSession ç®¡ç†æ©Ÿåˆ¶å®Œæ•´
3. **æ ¸å¿ƒ API å®Œæˆ**: åˆŠç™» CRUDã€å¸‚å ´åˆ—è¡¨ã€è³¼è²·æ„å‘å…¨éƒ¨å¯¦ä½œ
4. **ç¨‹å¼ç¢¼å“è³ª**: ç¬¦åˆ CLAUDE.md è¦ç¯„ï¼Œä½¿ç”¨ TypeScriptã€Next.js 15 æ­£ç¢ºè™•ç†å‹•æ…‹è·¯ç”±
5. **è³‡æ–™åº«è¨­è¨ˆ**: Schema å®Œæ•´ï¼Œç´¢å¼•å„ªåŒ–å·²å®Œæˆ

### å¾…æ”¹é€²

1. **å®‰å…¨æ€§**: Token åŠ å¯†å­˜å„²ï¼ˆCriticalï¼‰ã€RLS ç­–ç•¥é…ç½®ï¼ˆCriticalï¼‰
2. **åŠŸèƒ½å®Œæ•´æ€§**: å¸‚å ´æœå°‹ã€äº¤æ›åŒ¹é…ã€é…é¡æŸ¥è©¢
3. **ç¨‹å¼ç¢¼æ¸…æ½”**: æ¸…ç† TODO è¨»è§£

### ä¸‹ä¸€æ­¥

1. **æœ¬é€±**: å®Œæˆ Critical ç´šåˆ¥ä»»å‹™ï¼ˆToken åŠ å¯† + RLSï¼‰
2. **ä¸‹é€±**: å®Œæˆ High ç´šåˆ¥ä»»å‹™ï¼ˆæœå°‹ + åŒ¹é… + é…é¡ï¼‰
3. **ç¬¬ä¸‰é€±**: æ•´åˆæ¸¬è©¦ã€Bug ä¿®å¾©ã€ä¸Šç·šæº–å‚™

**é è¨ˆ**: **3 é€±å…§**å¯å®Œæˆ MVP ä¸¦ä¸Šç·šç”Ÿç”¢ç’°å¢ƒã€‚

---

**å ±å‘Šç”Ÿæˆæ™‚é–“**: 2025-10-26
**ä¸‹æ¬¡æ›´æ–°æ™‚é–“**: å®Œæˆ Critical ä»»å‹™å¾Œï¼ˆé è¨ˆ 2025-10-28ï¼‰
